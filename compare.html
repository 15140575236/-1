<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>JSON Diff - The semantic JSON compare tool</title>

        <link rel="stylesheet" href="reset.css" type="text/css" media="screen">
        <link rel="stylesheet" href="throbber.css" type="text/css" media="screen">
        <link rel="stylesheet" href="jdd.css" type="text/css" media="screen">

        <script src="./jquery-3.3.1.js" type="text/javascript" charset="utf-8"></script>

        <script src="jsl/jsl.format.js" type="text/javascript" charset="utf-8"></script>
        <script src="jsl/jsl.parser.js" type="text/javascript" charset="utf-8"></script>
        <script src="jdd.js" type="text/javascript" charset="utf-8"></script>

        <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-26336682-2', 'auto');
        ga('send', 'pageview');

    </script>
    </head>
    <body>

        <div id="main">
            <div class="header">
                <h1>JSON Diff</h1>
                <h3>The semantic JSON compare tool</h3>

                <div class="weak">


                </div>
            </div>

            <div class="initContainer">

                <div class="left">

                    <div class="row">
                    Cache:
                    <select style="margin-right: 215px" id="cache" name="">
                        <option value="0">no cache</option>
                        <option value="7" selected>7</option>
                        <option value="15">15</option>
                        <option value="30">30</option>
                    </select>

                    Select DB:
                    <select id="dbleft"style="margin: 1px;vertical-align: -1px;">
                        <option value = "CBS">CBS</option>
                        <option value = "RDH" selected>RDH</option>
                        <option value = "IERP">IERP</option>
                    </select>
                 </div>
				<br/>
                    <textarea spellcheck="false" autocomplete="off" id="textarealeft" placeholder="Enter JSON to compare, enter an URL to JSON"></textarea>
                    <pre id="errorLeft" class="error"></pre>
                    <p></p>
                    <button id="input" style="margin-right: 70px">Input</button >
                    <button id="compare" style="margin-right: 70px">Compare</button>
                    <button id="clean" style="margin-right: 70px">Clean</button>

                    <!-- <span class="fileInput">or <input type="file" id="fileLeft" onchange="jdd.handleFiles(this.files, 'left')"></span> -->
                </div>

               <div class="center">
					<!--<input type="button" name="button" class="btn btn-default" value="Input" onclick="show()"   /> -->

                <!--    <div class="throbber-loader"></div> -->
                   <!-- or try some<br />
					<a href="#" id="sample">sample data</a> -->

        </div>

                <div class="right">
                    <div class="row">
                        Select DB:
                        <select id="dbright" autocomplete="off">
                            <option value = "CBS" selected>CBS</option>
                            <option value = "RDH">RDH</option>
                            <option value = "IERP">IERP</option>
                        </select>
                    </div>
                    <br/>
                    <textarea spellcheck="false" class="right" autocomplete="off" id="textarearight" placeholder="Enter JSON to compare, enter an URL to JSON"></textarea>
                    <pre id="errorRight" class="error"></pre>
                    <!-- <span class="fileInput">or <input type="file" id="fileRight" onchange="jdd.handleFiles(this.files, 'right')"></span> -->

            </div>
            </div>

            <div class="diffcontainer">
                <div id="report">
                </div>
                <pre id="out" class="left" class="codeBlock"></pre>
                <pre id="out2" class="right" class="codeBlock"></pre>
                <ul id="toolbar" class="toolbar"></ul>
            </div>
        </div>

<script type="text/javascript">
var btn = document.getElementById("input");
    btn.addEventListener("click",estimate);

<!--var url = decodeURI(window.location.href);-->
<!--var argsIndex = url .split("?obj=");-->
<!--var argInt=argsIndex[1];-->
<!--var arg = argInt;-->

function estimate(){
      var leftoptions=$("#dbleft option:selected").val();
      var rightoptions=$("#dbright option:selected").val();
      if(leftoptions === rightoptions){
        alert("Please choose the different DB options");
      }else{
        apileft();
        console.log("1");
        apiright();
      }
    }

function apileft(){
    var cache_value=$("#cache option:selected").val();
      var optionsleft=$("#dbleft option:selected").val();
      optionsleft = optionsleft.toLocaleLowerCase();
      if(cache_value ==="0"){
        var url = "http://localhost:8088/api/v1/"+optionsleft+"/diff/5799CP2";
        getData(url,"textarealeft");
        console.log(url);
      }else{
        var url = "http://localhost:8088/api/v1/"+optionsleft+"/diff/5799CP2?day="+cache_value+"";
        getData(url,"textarealeft");
        console.log(url)
      }
}

function apiright(){
var cache_value=$("#cache option:selected").val();
var optionsright=$("#dbright option:selected").val();
optionsright = optionsright.toLocaleLowerCase();
 if(cache_value ==="0"){
        var url = "http://localhost:8088/api/v1/"+optionsright+"/diff/5799CP2";
        getData(url,"textarearight");
        console.log(url);
      }else{
        var url = "http://localhost:8088/api/v1/"+optionsright+"/diff/5799CP2?day="+cache_value+"";
        getData(url,"textarearight");
        console.log(url)
      }

}

function getData(url,name){
      $.get(url,function (data) {
        var jsonFormat = formatJson(data);
        document.getElementById(name).value=jsonFormat;
      });
    }

var formatJson = function(json, options) {
                    var reg = null,
                        formatted = '',
                        pad = 0,
                        PADDING = '    '; // one can also use '\t' or a different number of spaces
                    // optional settings
                    options = options || {};
                    // remove newline where '{' or '[' follows ':'
                    options.newlineAfterColonIfBeforeBraceOrBracket = (options.newlineAfterColonIfBeforeBraceOrBracket === true) ? true : false;
                    // use a space after a colon
                    options.spaceAfterColon = (options.spaceAfterColon === false) ? false : true;

                    // begin formatting...

                    // make sure we start with the JSON as a string
                    if (typeof json !== 'string') {
                        json = JSON.stringify(json);
                    }
                    // parse and stringify in order to remove extra whitespace
                    json = JSON.parse(json);
                    json = JSON.stringify(json);

                    // add newline before and after curly braces
                    reg = /([\{\}])/g;
                    json = json.replace(reg, '\r\n$1\r\n');

                    // add newline before and after square brackets
                    reg = /([\[\]])/g;
                    json = json.replace(reg, '\r\n$1\r\n');

                    // add newline after comma
                    reg = /(\,)/g;
                    json = json.replace(reg, '$1\r\n');

                    // remove multiple newlines
                    reg = /(\r\n\r\n)/g;
                    json = json.replace(reg, '\r\n');

                    // remove newlines before commas
                    reg = /\r\n\,/g;
                    json = json.replace(reg, ',');

                    // optional formatting...
                    if (!options.newlineAfterColonIfBeforeBraceOrBracket) {
                        reg = /\:\r\n\{/g;
                        json = json.replace(reg, ':{');
                        reg = /\:\r\n\[/g;
                        json = json.replace(reg, ':[');
                    }
                    if (options.spaceAfterColon) {
                        reg = /\:/g;
                        json = json.replace(reg, ': ');
                    }

                    $.each(json.split('\r\n'), function(index, node) {
                        var i = 0,
                            indent = 0,
                            padding = '';

                        if (node.match(/\{$/) || node.match(/\[$/)) {
                            indent = 1;
                        } else if (node.match(/\}/) || node.match(/\]/)) {
                            if (pad !== 0) {
                                pad -= 1;
                            }
                        } else {
                            indent = 0;
                        }

                        for (i = 0; i < pad; i++) {
                            padding += PADDING;
                        }

                        formatted += padding + node + '\r\n';
                        pad += indent;
                    });

                    return formatted;
                };
</script>

<script type="text/javascript">
    var clean = document.getElementById("clean");
    clean.addEventListener("click",cleanUp);
    function cleanUp() {
        var text = "";
        document.getElementById("textarealeft").value=text;
        document.getElementById("textarearight").value=text;
    }
</script>
</body>
</html>
